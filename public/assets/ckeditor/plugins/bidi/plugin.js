/*
 Copyright (c) 2003-2015, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.md or http://ckeditor.com/license
*/
!function(){function e(e,t,i,r){if(!e.isReadOnly()&&!e.equals(i.editable())){CKEDITOR.dom.element.setMarker(r,e,"bidi_processed",1);for(var r=e,n=i.editable();(r=r.getParent())&&!r.equals(n);)if(r.getCustomData("bidi_processed"))return e.removeStyle("direction"),void e.removeAttribute("dir");r="useComputedState"in i.config?i.config.useComputedState:1,(r?e.getComputedStyle("direction"):e.getStyle("direction")||e.hasAttribute("dir"))!=t&&(e.removeStyle("direction"),r?(e.removeAttribute("dir"),t!=e.getComputedStyle("direction")&&e.setAttribute("dir",t)):e.setAttribute("dir",t),i.forceNextSelectionCheck())}}function t(e,t,i){var r=e.getCommonAncestor(!1,!0),e=e.clone();if(e.enlarge(i==CKEDITOR.ENTER_BR?CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:CKEDITOR.ENLARGE_BLOCK_CONTENTS),e.checkBoundaryOfElement(r,CKEDITOR.START)&&e.checkBoundaryOfElement(r,CKEDITOR.END)){for(var n;r&&r.type==CKEDITOR.NODE_ELEMENT&&(n=r.getParent())&&1==n.getChildCount()&&!(r.getName()in t);)r=n;return r.type==CKEDITOR.NODE_ELEMENT&&r.getName()in t&&r}}function i(i){return{context:"p",allowedContent:{"h1 h2 h3 h4 h5 h6 table ul ol blockquote div tr p div li td":{propertiesOnly:!0,attributes:"dir"}},requiredContent:"p[dir]",refresh:function(e,t){var i=e.config.useComputedState,r,i=void 0===i||i;if(!i){r=t.lastElement;for(var n=e.editable();r&&!(r.getName()in a||r.equals(n));){var o=r.getParent();if(!o)break;r=o}}r=r||t.block||t.blockLimit,r.equals(e.editable())&&(n=e.getSelection().getRanges()[0].getEnclosedNode())&&n.type==CKEDITOR.NODE_ELEMENT&&(r=n),r&&(i=i?r.getComputedStyle("direction"):r.getStyle("direction")||r.getAttribute("dir"),e.getCommand("bidirtl").setState("rtl"==i?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF),e.getCommand("bidiltr").setState("ltr"==i?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)),(i=(t.block||t.blockLimit||e.editable()).getDirection(1))!=(e._.selDir||e.lang.dir)&&(e._.selDir=i,e.fire("contentDirChanged",i))},exec:function(r){var a=r.getSelection(),d=r.config.enterMode,l=a.getRanges();if(l&&l.length){for(var c={},E=a.createBookmarks(),l=l.createIterator(),s,u=0;s=l.getNextRange(1);){var g=s.getEnclosedNode();g&&(!g||g.type==CKEDITOR.NODE_ELEMENT&&g.getName()in o)||(g=t(s,n,d)),g&&e(g,i,r,c);var T=new CKEDITOR.dom.walker(s),C=E[u].startNode,O=E[u++].endNode;T.evaluator=function(e){var t=d==CKEDITOR.ENTER_P?"p":"div",i;return(i=!(e&&e.type==CKEDITOR.NODE_ELEMENT))||((i=e.getName()in n)&&((t=!e.is(t))||(t=e.getParent(),t=!(t&&t.type==CKEDITOR.NODE_ELEMENT&&e.getParent().is("blockquote"))),i=t&&e.getPosition(C)&CKEDITOR.POSITION_FOLLOWING&&(e.getPosition(O)&CKEDITOR.POSITION_PRECEDING+CKEDITOR.POSITION_CONTAINS)==CKEDITOR.POSITION_PRECEDING),i=!i),!i};for(;g=T.next();)e(g,i,r,c);for(s=s.createIterator(),s.enlargeBr=d!=CKEDITOR.ENTER_BR;g=s.getNextParagraph(d==CKEDITOR.ENTER_P?"p":"div");)e(g,i,r,c)}CKEDITOR.dom.element.clearAllMarkers(c),r.forceNextSelectionCheck(),a.selectBookmarks(E),r.focus()}}}}function r(e){var t=e==d.setAttribute,i=e==d.removeAttribute,r=/\bdirection\s*:\s*(.*?)\s*(:?$|;)/;return function(n,o){if(!this.isReadOnly()){var a;if(a=n==(t||i?"dir":"direction")||"style"==n&&(i||r.test(o))){e:{a=this;for(var d=a.getDocument().getBody().getParent();a;){if(a.equals(d)){a=!1;break e}a=a.getParent()}a=!0}a=!a}if(a&&(a=this.getDirection(1),d=e.apply(this,arguments),a!=this.getDirection(1)))return this.getDocument().fire("dirChanged",this),d}return e.apply(this,arguments)}}var n={table:1,ul:1,ol:1,blockquote:1,div:1},o={},a={};CKEDITOR.tools.extend(o,n,{tr:1,p:1,div:1,li:1}),CKEDITOR.tools.extend(a,o,{td:1}),CKEDITOR.plugins.add("bidi",{lang:"af,ar,bg,bn,bs,ca,cs,cy,da,de,el,en,en-au,en-ca,en-gb,eo,es,et,eu,fa,fi,fo,fr,fr-ca,gl,gu,he,hi,hr,hu,id,is,it,ja,ka,km,ko,ku,lt,lv,mk,mn,ms,nb,nl,no,pl,pt,pt-br,ro,ru,si,sk,sl,sq,sr,sr-latn,sv,th,tr,tt,ug,uk,vi,zh,zh-cn",icons:"bidiltr,bidirtl",hidpi:!0,init:function(e){function t(t,i,r,n,o){e.addCommand(r,new CKEDITOR.command(e,n)),e.ui.addButton&&e.ui.addButton(t,{label:i,command:r,toolbar:"bidi,"+o})}if(!e.blockless){var r=e.lang.bidi;t("BidiLtr",r.ltr,"bidiltr",i("ltr"),10),t("BidiRtl",r.rtl,"bidirtl",i("rtl"),20),e.on("contentDom",function(){e.document.on("dirChanged",function(t){e.fire("dirChanged",{node:t.data,dir:t.data.getDirection(1)})})}),e.on("contentDirChanged",function(t){var t=(e.lang.dir!=t.data?"add":"remove")+"Class",i=e.ui.space(e.config.toolbarLocation);i&&i[t]("cke_mixed_dir_content")})}}});for(var d=CKEDITOR.dom.element.prototype,l=["setStyle","removeStyle","setAttribute","removeAttribute"],c=0;c<l.length;c++)d[l[c]]=CKEDITOR.tools.override(d[l[c]],r)}();